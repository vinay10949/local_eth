services:
  # Single eth instance
  anvil:
    image: ghcr.io/foundry-rs/foundry:latest
    container_name: anvil-blockchain
    entrypoint: ["anvil"]
    command:
      - --host
      - "0.0.0.0"
      - --port
      - "8545"
      - --block-time
      - "2"
      - --accounts
      - "10"
      - --balance
      - "10000"
    networks:
      - local_eth
    healthcheck:
      test: ["CMD", "cast", "block-number", "--rpc-url", "http://localhost:8545"]
      interval: 5s
      timeout: 3s
      retries: 5

  # RPC Proxy #1
  node_1:
    image: nginx:alpine
    container_name: rpc-proxy-8545
    volumes:
      - ./nginx-proxy.conf:/etc/nginx/nginx.conf:ro
    ports:
      - "8545:80"
    depends_on:
      anvil:
        condition: service_healthy
    networks:
      - local_eth

  # RPC Proxy #2
  node_2:
    image: nginx:alpine
    container_name: rpc-proxy-8546
    volumes:
      - ./nginx-proxy.conf:/etc/nginx/nginx.conf:ro
    ports:
      - "8546:80"
    depends_on:
      anvil:
        condition: service_healthy
    networks:
      - local_eth

  # RPC Proxy #3
  node_3:
    image: nginx:alpine
    container_name: rpc-proxy-8547
    volumes:
      - ./nginx-proxy.conf:/etc/nginx/nginx.conf:ro
    ports:
      - "8547:80"
    depends_on:
      anvil:
        condition: service_healthy
    networks:
      - local_eth

networks:
  local_eth:
    driver: bridge
